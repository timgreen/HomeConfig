---
- block:
  - name: check navi install
    command: navi --version
    register: navi_check
    ignore_errors: yes
    changed_when: false
    check_mode: no

  - name: install navi
    shell: |
      BIN_DIR=$HOME/bin bash <(curl -sL https://raw.githubusercontent.com/denisidoro/navi/v2.20.1/scripts/install | grep -v 'append_to_file ')
    when: navi_check.rc > 0

  - name: stow navi
    command: stow -v -t ~ -d {{ role_path }}/files -S . --no-folding
    register: output
    changed_when: '"LINK" in output.stderr'

  tags:
    navi
